<div class="row">
    <h2 class="row-seperator-header">
        <i class="fa fa-search"></i> Content Search Tool
    </h2>
    <article class="col-md-12">
        <div class="jarviswidget well" id="wid-id-3" data-widget-colorbutton="false" data-widget-editbutton="false" data-widget-togglebutton="false" data-widget-deletebutton="false" data-widget-fullscreenbutton="false" data-widget-custombutton="false" data-widget-sortable="false">
            <header>
                <span class="widget-icon">
                    <i class="fa fa-comments"></i>
                </span>
            </header>
            <div>
                <div class="widget-body">

                    <div class="input-group input-group-lg hidden-mobile">
                        <input class="form-control input-lg" type="text" placeholder="Search website content..." id="websiteUrl">
                        <div class="input-group-btn">
                            <button type="button" id="searchContent" class="btn btn-default">
                                &nbsp;&nbsp;&nbsp;<i class="fa fa-fw fa-search fa-lg"></i>&nbsp;&nbsp;&nbsp;
                            </button>
                        </div>
                    </div>
                    <hr class="simple">

                    <ul id="myTab1" class="nav nav-tabs bordered">
                        <li class="active">
                            <a href="#s1" name="imageTab" data-toggle="tab"><i class="fa fa-fw fa-lg fa-image"></i> Images</a>
                        </li>
                        <li>
                            <a href="#s2" name="chartTab" data-toggle="tab"><i class="fa fa-fw fa-lg fa-area-chart"></i> Top Keywords</a>
                        </li>
                    </ul>

                    <div id="myTabContent1" class="tab-content padding-10">
                        <div class="tab-pane fade in active" id="s1">
                            <p>
                                <div class="lightBoxGallery">
                                    <div id="webImages" class="lightBoxGallery">

                                    </div>
                                    <div id="blueimp-gallery" class="blueimp-gallery blueimp-gallery-controls">
                                        <div class="slides"></div>
                                        <h3 class="title"></h3>
                                        <a class="prev">‹</a>
                                        <a class="next">›</a>
                                        <a class="close">×</a>
                                        <a class="play-pause"></a>
                                        <ol class="indicator"></ol>
                                    </div>

                                </div>
                            </p>
                        </div>
                        <div class="tab-pane fade" id="s2">
                            <p>
                                <section id="widget-grid" class="">
                                    <div class="row">
                                        <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                                            <div class="jarviswidget" id="wid-id-4" data-widget-editbutton="false">
                                                <header>
                                                    <span class="widget-icon">
                                                        <i class="fa fa-bar-chart-o"></i>
                                                    </span>
                                                    <h2>Sales Chart</h2>
                                                </header>
                                                <div>

                                                    <h3><span id="totalWordCount"></span></h3>
                                                    <div class="jarviswidget-editbox">
                                                    </div>
                                                    <div class="widget-body no-padding">
                                                        <div id="saleschart" class="chart" style="width:100%;height:350px;"></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </article>
                                    </div>
                                </section>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </article>
</div>

@section Scripts {
    <script src="~/js/plugin/blueimp/jquery.blueimp-gallery.min.js"></script>

    <script>
        var chartData;
        function isValidURL(str) {
            return str !== undefined && (str.indexOf("http://") != -1 || str.indexOf("https://") != -1);
        }

        $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
            if (e.target.name === "chartTab") {
                pagefunction(chartData);
            }
        });

        $("#searchContent").click(function () {

            var requestWebUrl = $('#websiteUrl').val();
            var dataObject = {
                'url': requestWebUrl
            };

            $.ajax({
                type: "POST",
                url: "http://localhost:49756/api/content/search",
                dataType: 'json',
                data: dataObject,
                success: function (response) {
                    if (response.keyWords !== null && response.keyWords !== undefined
                        && response.keyWords.items !== null && response.keyWords.items.length > 0) {
                        chartData = response;
                    }

                    var htmlString = "";
                    $.each(response.images, function (i, item) {
                        if (!isValidURL(item)) {
                            item = requestWebUrl + item;
                        }
                        imageUrl = item
                        htmlString += "<a href='" + item + "' data-gallery=''><img style='margin: 5px;' src='" + item + "' height='100px' width='100px'></a>";
                    });

                    $('#webImages').html(htmlString + "");
                    pagefunction(response);
                },
                fail: function (error) {
                }
            });
        });
    </script>

    <script type="text/javascript">


        var plot_1;

        pageSetUp();

        function createArray(length) {
            var arr = new Array(length || 0),
                i = length;

            if (arguments.length > 1) {
                var args = Array.prototype.slice.call(arguments, 1);
                while (i--) arr[length - 1 - i] = createArray.apply(this, args);
            }

            return arr;
        }

        // PAGE RELATED SCRIPTS

        var pagefunction = function (result) {

            /* chart colors default */
            var $chrt_border_color = "#efefef";
            var $chrt_grid_color = "#DDD";
            var $chrt_main = "#E24913"; /* red       */
            var $chrt_second = "#6595b4"; /* blue      */
            var $chrt_third = "#FF9F01"; /* orange    */
            var $chrt_fourth = "#7e9d3a"; /* green     */
            var $chrt_fifth = "#BD362F"; /* dark red  */
            var $chrt_mono = "#000";

            /* sales chart */

            if ($("#saleschart").length && result !== undefined
                && result.keyWords !== undefined) {
                var data = createArray(result.keyWords.items.length, 2);
                for (var pr = 0; pr < result.keyWords.items.length; pr++) {
                    data[pr][0] = result.keyWords.items[pr].key;
                    data[pr][1] = parseInt(result.keyWords.items[pr].value);
                }

                $.plot("#saleschart", [data], {
                    series: {
                        bars: {
                            show: true,
                            barWidth: 0.6,
                            align: "center"
                        }
                    },
                    grid: {
                        color: '#999',
                        borderColor: '#fff',
                        borderWidth: 1,
                        hoverable: true,
                        clickable: true,
                    },
                    xaxis: {
                        mode: "categories",
                        tickColor: '#fff'
                    },
                    tooltip: {
                        show: true
                    },
                    tooltipOpts: {
                        content: "Total Count : <span>%y</span>",
                        dateFormat: "%y-%0m-%0d",
                        defaultTheme: false
                    },
                    colors: ['#E91E63']
                });
                $('#saleschart').removeAttr("style");
                $('#saleschart').attr("style", "padding:12px;");
                $('#totalWordCount').text('Total Keywords Count:' + result.keyWords.totalCount);
            };

            /* end sales chart */
        };

        var pagedestroy = function () {

            //destroy flots
            plot_1.shutdown();
            plot_1 = null;
        };

        // load all flot plugins
        loadScript("/js/plugin/flot/jquery.flot.cust.min.js",
            function () {
                loadScript("/js/plugin/flot/jquery.flot.resize.min.js",
                    function () {
                        loadScript("/js/plugin/flot/jquery.flot.fillbetween.min.js",
                            function () {
                                loadScript("/js/plugin/flot/jquery.flot.orderBar.min.js",
                                    function () {
                                        loadScript("/js/plugin/flot/jquery.flot.categories.min.js",
                                            function () {
                                                loadScript("/js/plugin/flot/jquery.flot.time.min.js",
                                                    function () {
                                                        loadScript("/js/plugin/flot/jquery.flot.tooltip.min.js");
                                                    });
                                            });
                                    });
                            });
                    });
            });

    </script>
}
